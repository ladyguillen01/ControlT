Número de parámetros optimizados: 8
Parámetros (vector): [-8.17275000e-03  9.99904670e-01  3.56901059e+02 -6.52352583e+00
 -6.84180000e-04  1.21600000e-05 -3.78252925e+00  7.71711200e-02]
R² = 0.933377
Correlación (Pearson) = 0.966114

#############  estimacion 40
-- 1️⃣ Contamos cuántas cosechas tiene cada maduración
WITH conteo AS (
    SELECT 
        maduracion,
        MAX(pd) AS pd,
        MAX(saldoinicoa) AS saldoinicoa
    FROM tabla_original
    GROUP BY maduracion
),

-- 2️⃣ Generamos la secuencia 0–40 (todas las posibles cosechas)
maduraciones AS (
    SELECT posexplode(sequence(0, 40)) AS (pos, cosecha)
),

-- 3️⃣ Cruzamos todas las maduraciones con la secuencia 0–40
completo AS (
    SELECT 
        c.maduracion,
        m.cosecha,
        c.pd,
        c.saldoinicoa
    FROM conteo c
    CROSS JOIN maduraciones m
),

-- 4️⃣ Hacemos un LEFT JOIN con la tabla original para rellenar sólo los faltantes
final AS (
    SELECT 
        comp.maduracion,
        comp.cosecha,
        comp.pd,
        COALESCE(orig.provisionacum, NULL) AS provisionacum,
        comp.saldoinicoa
    FROM completo comp
    LEFT JOIN tabla_original orig
        ON comp.maduracion = orig.maduracion
       AND comp.cosecha = orig.cosecha
)

-- 5️⃣ Resultado ordenado
SELECT *
FROM final
ORDER BY maduracion, cosecha;


