proc sql;
create table MiVivienda_Garantias_1 as
select distinct
    compress(b.CODINTERNOCOMPUTACIONAL) as CIC,
    substr(b.CODDOC,5,8) as IDC,
    b.TIPDOC as TIPO_IDC,
    substr(compress(b.NBRCLI)||' '||compress(b.APEPATCLI)||' '||compress(b.APEMATCLI),1,40) as NOMBRES,

    case 
        when datepart(FECDESEMBOLSOORIGINAL) <= '15AUG2009'd then 0.3333
        when datepart(FECDESEMBOLSOORIGINAL) between '16SEP2009'd and '14AUG2014'd then 0.3333
        when datepart(FECDESEMBOLSOORIGINAL) between '15AUG2014'd and '31DEC2021'd then 0.3333

        when datepart(FECDESEMBOLSOORIGINAL) >= '01JAN2022'd then
            case 
                when FLG_CC = 1 then 0.3333
                when MTOBIENADQUIRIR between 61200 and 232200 then 
                    case 
                        when GRADO_SOSTENIBILIDAD = 'GRADO1' then 0.1000
                        when GRADO_SOSTENIBILIDAD = 'GRADO2' then 0.2000
                        when GRADO_SOSTENIBILIDAD = 'GRADO3' then 0.3000
                        else 0.4000
                    end
                when MTOBIENADQUIRIR > 232200 and MTOBIENADQUIRIR <= 360000 then 
                    case 
                        when GRADO_SOSTENIBILIDAD = 'GRADO1' then 0.0000
                        when GRADO_SOSTENIBILIDAD = 'GRADO2' then 0.1000
                        when GRADO_SOSTENIBILIDAD = 'GRADO3' then 0.2000
                        else 0.3000
                    end
                else 0 /* en vez de . puedes dejar cero explÃ­cito */
            end

        else 0.3333
    end as COBERTURA_ADICIONAL

from MiVivienda_Garantias_01 a
left join ods_v.md_clienteg94 b
    on a.CODCLAVECIC = b.CODCLAVECIC and b.FLGREGELIMINADO = 'N'
where TIPESTGAR = '10'
  and calculated COBERTURA_ADICIONAL > 0;
quit;
