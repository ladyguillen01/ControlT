Número de parámetros optimizados: 8
Parámetros (vector): [-8.17275000e-03  9.99904670e-01  3.56901059e+02 -6.52352583e+00
 -6.84180000e-04  1.21600000e-05 -3.78252925e+00  7.71711200e-02]
R² = 0.933377
Correlación (Pearson) = 0.966114

#############  estimacion 40
WITH conteo AS (
  SELECT 
    cosecha,
    MAX(maduracion) AS max_maduracion,
    MAX(saldo_inicial) AS saldo_inicial,
    MAX(pdponderado) AS pdponderado
  FROM catalog_lhcl_prod_bcp.bcp_edv_rbm.T65734_caldesagregada
  GROUP BY cosecha
),

-- genera secuencia de números del 1 al 40
maduraciones AS (
  SELECT posexplode(sequence(1, 40)) AS (pos, maduracion)
),

-- genera combinaciones hasta maduración 40
maduraciones_faltantes AS (
  SELECT 
    c.cosecha,
    m.maduracion,
    c.saldo_inicial,
    c.pdponderado,
    NULL AS provisionporc,
    NULL AS rango_pd,
    NULL AS porcentajeacum,
    NULL AS codmes,
    NULL AS tipcredito
  FROM conteo c
  JOIN maduraciones m
    ON m.maduracion > c.max_maduracion
   AND m.maduracion <= 40
),

-- une los registros originales con los nuevos (sin duplicar)
resultado_final AS (
  SELECT 
    cosecha,
    maduracion,
    saldo_inicial,
    pdponderado,
    provisionporc,
    rango_pd,
    porcentajeacum,
    codmes,
    tipcredito
  FROM catalog_lhcl_prod_bcp.bcp_edv_rbm.T65734_caldesagregada

  UNION ALL

  SELECT 
    cosecha,
    maduracion,
    saldo_inicial,
    pdponderado,
    provisionporc,
    rango_pd,
    porcentajeacum,
    codmes,
    tipcredito
  FROM maduraciones_faltantes
)

SELECT *
FROM resultado_final
ORDER BY cosecha, maduracion;
