
WITH tabla AS (
    SELECT
        TIPBLOQUEOCREDITOPERSONAL, CODCLAVECTA,
        DATE_FORMAT(FECSALDO, '%Y%m') AS CODMES,
        ROW_NUMBER() OVER (
            PARTITION BY DATE_FORMAT(FECSALDO, '%Y%m')
            ORDER BY FECSALDO DESC
        ) AS rn
    FROM catalog_lhcl_prod_bcp.bcp_udv_int_vU.h_saldocuentacreditopersonal t
)
SELECT *
FROM tabla
WHERE rn = 1

[INCONSISTENT_BEHAVIOR_CROSS_VERSION.DATETIME_PATTERN_RECOGNITION] You may get a different result due to the upgrading to Spark >= 3.0:
Fail to recognize '%Y%m' pattern in the DateTimeFormatter.
1) You can set "legacy_time_parser_policy" to "LEGACY" to restore the behavior before Spark 3.0.
2) You can form a valid datetime pattern with the guide from 'https://spark.apache.org/docs/latest/sql-ref-datetime-pattern.html'. SQLSTATE: 42K0B
